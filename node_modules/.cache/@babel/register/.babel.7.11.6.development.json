{
  "{\"sourceRoot\":\"/Users/catherineparnell/api-ivyhacks/src/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/Users/catherineparnell/api-ivyhacks\",\"filename\":\"/Users/catherineparnell/api-ivyhacks/src/server.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/catherineparnell/api-ivyhacks\",\"plugins\":[],\"presets\":[]}:7.11.6": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/catherineparnell/api-ivyhacks/src/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/Users/catherineparnell/api-ivyhacks",
      "filename": "/Users/catherineparnell/api-ivyhacks/src/server.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/catherineparnell/api-ivyhacks",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/catherineparnell/api-ivyhacks/src/server.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/Users/catherineparnell/api-ivyhacks/src/server.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/catherineparnell/api-ivyhacks/src/",
        "sourceFileName": "server.js"
      }
    },
    "ast": null,
    "code": "// import apiRouter from './router';\nconst express = require('express');\n\nconst cors = require('cors');\n\nconst morgan = require('morgan');\n\nconst path = require('path');\n\nconst bodyParser = require('body-parser');\n\nconst dotenv = require('dotenv');\n\ndotenv.config({\n  silent: true\n}); // initialize\n\nconst app = express(); // enable/disable cross origin resource sharing if necessary\n\napp.use(cors()); // enable/disable http request logging\n\napp.use(morgan('dev')); // enable only if you want templating\n\napp.set('view engine', 'ejs'); // enable only if you want static assets from folder static\n\napp.use(express.static('static')); // this just allows us to render ejs from the ../app/views directory\n\napp.set('views', path.join(__dirname, '../src/views')); // enable json message body for posting data to API\n\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.use(bodyParser.json()); // additional init stuff should go before hitting the routing\n// REGISTER OUR ROUTES -------------------------------\n// all of our routes will be prefixed with /api\n// this should go AFTER body parser\n// app.use('/api', apiRouter);\n\napp.get('/api/hello-world', async (req, res) => {\n  const docRef = db.collection('tests').doc('alovelace');\n  await docRef.set({\n    first: 'Ada',\n    last: 'Lovelace',\n    born: 1815\n  });\n  return res.status(200).send('Hello World!');\n});\n\nconst PersonalityInsightsV3 = require('ibm-watson/personality-insights/v3');\n\nconst {\n  IamAuthenticator\n} = require('ibm-watson/auth');\n\nconst personalityInsights = new PersonalityInsightsV3({\n  version: '2017-10-13',\n  authenticator: new IamAuthenticator({\n    apikey: process.env.IBMKEY\n  }),\n  serviceUrl: 'https://api.us-east.personality-insights.watson.cloud.ibm.com/instances/e243b357-33f5-45ec-a2e3-a4fdabccd55c'\n});\n\nfunction calculate_similarity(user, candidate, num) {\n  let per = 0;\n\n  for (i = 0; i < num; i++) {\n    per += Math.min(user[i].raw_score, candidate[i].raw_score) / Math.max(user[i].raw_score, candidate[i].raw_score);\n  }\n\n  return per / num;\n}\n\napp.put('/api/text-recommendations/', async (req, res) => {\n  // get user profile from ibm\n  const userProfileParams = {\n    // req.body.userText\n    content: req.body.userText,\n    contentType: 'text/plain;charset=utf-8',\n    consumptionPreferences: true,\n    rawScores: true\n  };\n  let user_profile = await personalityInsights.profile(userProfileParams); // for each election in elections\n  // console.log(req.body.elections);\n\n  const elections = req.body.elections;\n\n  for (election of elections) {\n    // eslint-disable-next-line consistent-return\n    try {\n      let candidate_profiles = []; // try and get candidates' profiles from election\n\n      for (candidate of election.candidates) {\n        let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\";\n        const candidateProfileParams = {\n          content: candidate_content,\n          contentType: 'text/plain;charset=utf-8',\n          consumptionPreferences: true,\n          rawScores: true\n        };\n        profile = await personalityInsights.profile(candidateProfileParams); // add profile to candidate json\n\n        candidate[\"profile\"] = profile; // add profile to candidate profiles for store in firebase\n\n        candidate_profiles.push(profile); // calculate needs_score and values_score with user_profile\n\n        const needs_score = calculate_similarity(user_profile.result.needs, candidate.profile.result.needs, 12);\n        const values_score = calculate_similarity(user_profile.result.values, candidate.profile.result.values, 5);\n        candidate.profile[\"needs_score\"] = needs_score;\n        candidate.profile[\"values_score\"] = values_score; // take average and add to candidate.profile under \"average_score\"\n\n        candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n      }\n    } catch (error) {\n      console.log(error);\n      return res.status(500).send(error);\n    }\n  } // return elections\n\n\n  return res.status(200).send({\n    elections\n  });\n});\napp.put('/api/slide-recommendations/', async (req, res) => {\n  const user_profile = req.body.user;\n  const elections = req.body.elections;\n\n  for (election of elections) {\n    // eslint-disable-next-line consistent-return                 \n    let candidate_profiles = []; // if candidates' profiles from election not stored in firebase\n\n    try {\n      for (candidate of election.candidates) {\n        let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\";\n        const candidateProfileParams = {\n          content: candidate_content,\n          contentType: 'text/plain;charset=utf-8',\n          consumptionPreferences: true,\n          rawScores: true\n        };\n        profile = await personalityInsights.profile(candidateProfileParams); // add profile to candidate json\n\n        candidate[\"profile\"] = profile; // add profile to candidate profiles for store in firebase\n\n        candidate_profiles.push(profile); // calculate needs_score and values_score with user_profile\n\n        const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n        const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n        candidate.profile[\"needs_score\"] = needs_score;\n        candidate.profile[\"values_score\"] = values_score; // take average and add to candidate.profile under \"average_score\"\n\n        candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n      }\n    } catch (error) {\n      console.log(error);\n      return res.status(500).send(error);\n    }\n  } // return elections\n\n\n  return res.status(200).send({\n    elections\n  });\n}); // START THE SERVER\n// =============================================================================\n\nconst port = process.env.PORT || 8081;\napp.listen(port);\nconsole.log(`listening on: ${port}`);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJtb3JnYW4iLCJwYXRoIiwiYm9keVBhcnNlciIsImRvdGVudiIsImNvbmZpZyIsInNpbGVudCIsImFwcCIsInVzZSIsInNldCIsInN0YXRpYyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJqc29uIiwiZ2V0IiwicmVxIiwicmVzIiwiZG9jUmVmIiwiZGIiLCJjb2xsZWN0aW9uIiwiZG9jIiwiZmlyc3QiLCJsYXN0IiwiYm9ybiIsInN0YXR1cyIsInNlbmQiLCJQZXJzb25hbGl0eUluc2lnaHRzVjMiLCJJYW1BdXRoZW50aWNhdG9yIiwicGVyc29uYWxpdHlJbnNpZ2h0cyIsInZlcnNpb24iLCJhdXRoZW50aWNhdG9yIiwiYXBpa2V5IiwicHJvY2VzcyIsImVudiIsIklCTUtFWSIsInNlcnZpY2VVcmwiLCJjYWxjdWxhdGVfc2ltaWxhcml0eSIsInVzZXIiLCJjYW5kaWRhdGUiLCJudW0iLCJwZXIiLCJpIiwiTWF0aCIsIm1pbiIsInJhd19zY29yZSIsIm1heCIsInB1dCIsInVzZXJQcm9maWxlUGFyYW1zIiwiY29udGVudCIsImJvZHkiLCJ1c2VyVGV4dCIsImNvbnRlbnRUeXBlIiwiY29uc3VtcHRpb25QcmVmZXJlbmNlcyIsInJhd1Njb3JlcyIsInVzZXJfcHJvZmlsZSIsInByb2ZpbGUiLCJlbGVjdGlvbnMiLCJlbGVjdGlvbiIsImNhbmRpZGF0ZV9wcm9maWxlcyIsImNhbmRpZGF0ZXMiLCJjYW5kaWRhdGVfY29udGVudCIsImNhbmRpZGF0ZVByb2ZpbGVQYXJhbXMiLCJwdXNoIiwibmVlZHNfc2NvcmUiLCJyZXN1bHQiLCJuZWVkcyIsInZhbHVlc19zY29yZSIsInZhbHVlcyIsImVycm9yIiwiY29uc29sZSIsImxvZyIsInBvcnQiLCJQT1JUIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBLE1BQU1BLE9BQU8sR0FB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QXlCRyxNQUEvQyxFQUF1RCxDQUF2RCxDQUF6QztBQUNBN0IsUUFBQUEsU0FBUyxDQUFDaUIsT0FBVixDQUFrQixhQUFsQixJQUFtQ1EsV0FBbkM7QUFDQXpCLFFBQUFBLFNBQVMsQ0FBQ2lCLE9BQVYsQ0FBa0IsY0FBbEIsSUFBb0NXLFlBQXBDLENBbEJtQyxDQW1CbkM7O0FBQ0E1QixRQUFBQSxTQUFTLENBQUNpQixPQUFWLENBQWtCLGVBQWxCLElBQXFDLENBQUNRLFdBQVcsR0FBR0csWUFBZixJQUErQixDQUFwRTtBQUNIO0FBQ0osS0F2QkQsQ0F1QkUsT0FBT0UsS0FBUCxFQUFjO0FBQ1pDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaO0FBQ0EsYUFBT3BELEdBQUcsQ0FBQ1EsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCMkMsS0FBckIsQ0FBUDtBQUNIO0FBQ1osR0FuQ2tELENBb0NuRDs7O0FBQ0EsU0FBT3BELEdBQUcsQ0FBQ1EsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO0FBQUMrQixJQUFBQTtBQUFELEdBQXJCLENBQVA7QUFDSCxDQXRDTCxFLENBeUNSO0FBQ0E7O0FBQ0EsTUFBTWUsSUFBSSxHQUFHdkMsT0FBTyxDQUFDQyxHQUFSLENBQVl1QyxJQUFaLElBQW9CLElBQWpDO0FBQ0FuRSxHQUFHLENBQUNvRSxNQUFKLENBQVdGLElBQVg7QUFFQUYsT0FBTyxDQUFDQyxHQUFSLENBQWEsaUJBQWdCQyxJQUFLLEVBQWxDIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9jYXRoZXJpbmVwYXJuZWxsL2FwaS1pdnloYWNrcy9zcmMvIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IGFwaVJvdXRlciBmcm9tICcuL3JvdXRlcic7XG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcbmNvbnN0IG1vcmdhbiA9IHJlcXVpcmUoJ21vcmdhbicpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xuXG5jb25zdCBkb3RlbnYgPSByZXF1aXJlKCdkb3RlbnYnKTtcbmRvdGVudi5jb25maWcoeyBzaWxlbnQ6IHRydWUgfSk7XG5cbi8vIGluaXRpYWxpemVcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuLy8gZW5hYmxlL2Rpc2FibGUgY3Jvc3Mgb3JpZ2luIHJlc291cmNlIHNoYXJpbmcgaWYgbmVjZXNzYXJ5XG5hcHAudXNlKGNvcnMoKSk7XG5cbi8vIGVuYWJsZS9kaXNhYmxlIGh0dHAgcmVxdWVzdCBsb2dnaW5nXG5hcHAudXNlKG1vcmdhbignZGV2JykpO1xuXG4vLyBlbmFibGUgb25seSBpZiB5b3Ugd2FudCB0ZW1wbGF0aW5nXG5hcHAuc2V0KCd2aWV3IGVuZ2luZScsICdlanMnKTtcblxuLy8gZW5hYmxlIG9ubHkgaWYgeW91IHdhbnQgc3RhdGljIGFzc2V0cyBmcm9tIGZvbGRlciBzdGF0aWNcbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMoJ3N0YXRpYycpKTtcblxuLy8gdGhpcyBqdXN0IGFsbG93cyB1cyB0byByZW5kZXIgZWpzIGZyb20gdGhlIC4uL2FwcC92aWV3cyBkaXJlY3RvcnlcbmFwcC5zZXQoJ3ZpZXdzJywgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3NyYy92aWV3cycpKTtcblxuLy8gZW5hYmxlIGpzb24gbWVzc2FnZSBib2R5IGZvciBwb3N0aW5nIGRhdGEgdG8gQVBJXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuXG4vLyBhZGRpdGlvbmFsIGluaXQgc3R1ZmYgc2hvdWxkIGdvIGJlZm9yZSBoaXR0aW5nIHRoZSByb3V0aW5nXG5cbi8vIFJFR0lTVEVSIE9VUiBST1VURVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gYWxsIG9mIG91ciByb3V0ZXMgd2lsbCBiZSBwcmVmaXhlZCB3aXRoIC9hcGlcbi8vIHRoaXMgc2hvdWxkIGdvIEFGVEVSIGJvZHkgcGFyc2VyXG4vLyBhcHAudXNlKCcvYXBpJywgYXBpUm91dGVyKTtcblxuYXBwLmdldCgnL2FwaS9oZWxsby13b3JsZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIGNvbnN0IGRvY1JlZiA9IGRiLmNvbGxlY3Rpb24oJ3Rlc3RzJykuZG9jKCdhbG92ZWxhY2UnKTtcblxuICAgIGF3YWl0IGRvY1JlZi5zZXQoe1xuICAgICAgICBmaXJzdDogJ0FkYScsXG4gICAgICAgIGxhc3Q6ICdMb3ZlbGFjZScsXG4gICAgICAgIGJvcm46IDE4MTVcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoJ0hlbGxvIFdvcmxkIScpO1xufSk7XG5cbmNvbnN0IFBlcnNvbmFsaXR5SW5zaWdodHNWMyA9IHJlcXVpcmUoJ2libS13YXRzb24vcGVyc29uYWxpdHktaW5zaWdodHMvdjMnKTtcbmNvbnN0IHsgSWFtQXV0aGVudGljYXRvciB9ID0gcmVxdWlyZSgnaWJtLXdhdHNvbi9hdXRoJyk7XG5cbmNvbnN0IHBlcnNvbmFsaXR5SW5zaWdodHMgPSBuZXcgUGVyc29uYWxpdHlJbnNpZ2h0c1YzKHtcbiAgICB2ZXJzaW9uOiAnMjAxNy0xMC0xMycsXG4gICAgYXV0aGVudGljYXRvcjogbmV3IElhbUF1dGhlbnRpY2F0b3Ioe1xuICAgICAgYXBpa2V5OiBwcm9jZXNzLmVudi5JQk1LRVksXG4gICAgfSksXG4gICAgc2VydmljZVVybDogJ2h0dHBzOi8vYXBpLnVzLWVhc3QucGVyc29uYWxpdHktaW5zaWdodHMud2F0c29uLmNsb3VkLmlibS5jb20vaW5zdGFuY2VzL2UyNDNiMzU3LTMzZjUtNDVlYy1hMmUzLWE0ZmRhYmNjZDU1YycsXG4gIH0pO1xuXG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaW1pbGFyaXR5KHVzZXIsIGNhbmRpZGF0ZSwgbnVtKSB7XG4gICAgbGV0IHBlciA9IDA7XG4gICAgZm9yIChpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgICAgIHBlciArPSBNYXRoLm1pbih1c2VyW2ldLnJhd19zY29yZSwgY2FuZGlkYXRlW2ldLnJhd19zY29yZSkvTWF0aC5tYXgodXNlcltpXS5yYXdfc2NvcmUsIGNhbmRpZGF0ZVtpXS5yYXdfc2NvcmUpO1xuICAgIH1cbiAgICByZXR1cm4gKHBlciAvIG51bSlcbn1cblxuXG5hcHAucHV0KCcvYXBpL3RleHQtcmVjb21tZW5kYXRpb25zLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgICAgICAvLyBnZXQgdXNlciBwcm9maWxlIGZyb20gaWJtXG4gICAgICAgIGNvbnN0IHVzZXJQcm9maWxlUGFyYW1zID0ge1xuICAgICAgICAgICAgLy8gcmVxLmJvZHkudXNlclRleHRcbiAgICAgICAgICAgIGNvbnRlbnQ6IHJlcS5ib2R5LnVzZXJUZXh0LFxuICAgICAgICAgICAgY29udGVudFR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnLFxuICAgICAgICAgICAgY29uc3VtcHRpb25QcmVmZXJlbmNlczogdHJ1ZSxcbiAgICAgICAgICAgIHJhd1Njb3JlczogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IHVzZXJfcHJvZmlsZSA9IGF3YWl0IHBlcnNvbmFsaXR5SW5zaWdodHMucHJvZmlsZSh1c2VyUHJvZmlsZVBhcmFtcyk7XG4gICAgXG4gICAgICAgIC8vIGZvciBlYWNoIGVsZWN0aW9uIGluIGVsZWN0aW9uc1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXEuYm9keS5lbGVjdGlvbnMpO1xuICAgICAgICBjb25zdCBlbGVjdGlvbnMgPSByZXEuYm9keS5lbGVjdGlvbnM7XG4gICAgICAgIGZvciAoZWxlY3Rpb24gb2YgZWxlY3Rpb25zKSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY2FuZGlkYXRlX3Byb2ZpbGVzID0gW107XG4gICAgICAgICAgICAgICAgICAgIC8vIHRyeSBhbmQgZ2V0IGNhbmRpZGF0ZXMnIHByb2ZpbGVzIGZyb20gZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNhbmRpZGF0ZSBvZiBlbGVjdGlvbi5jYW5kaWRhdGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjYW5kaWRhdGVfY29udGVudCA9IFwiVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBhbmQgaGlzIGVudGlyZSBmYW1pbHkgaGF2ZSBiZWVuIGJsZXNzZWQgdG8gbGl2ZSB0aGUgQW1lcmljYW4gRHJlYW0g4oCUIHRoZSBpZGVhIHRoYXQgYW55b25lLCB0aHJvdWdoIGhhcmQgd29yayBhbmQgZGV0ZXJtaW5hdGlvbiwgY2FuIGFjaGlldmUgYW55dGhpbmcuIEFuZCBoZSBpcyBjb21taXR0ZWQgdG8gZW5zdXJpbmcgZXZlcnkgZmFtaWx5IGhhcyB0aGF0IHNhbWUgb3Bwb3J0dW5pdHkuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlUHJvZmlsZVBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNhbmRpZGF0ZV9jb250ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtcHRpb25QcmVmZXJlbmNlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhd1Njb3JlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlID0gYXdhaXQgcGVyc29uYWxpdHlJbnNpZ2h0cy5wcm9maWxlKGNhbmRpZGF0ZVByb2ZpbGVQYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcHJvZmlsZSB0byBjYW5kaWRhdGUganNvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVbXCJwcm9maWxlXCJdID0gcHJvZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHByb2ZpbGUgdG8gY2FuZGlkYXRlIHByb2ZpbGVzIGZvciBzdG9yZSBpbiBmaXJlYmFzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVfcHJvZmlsZXMucHVzaChwcm9maWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIG5lZWRzX3Njb3JlIGFuZCB2YWx1ZXNfc2NvcmUgd2l0aCB1c2VyX3Byb2ZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVlZHNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUucmVzdWx0Lm5lZWRzLCBjYW5kaWRhdGUucHJvZmlsZS5yZXN1bHQubmVlZHMsIDEyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzX3Njb3JlID0gY2FsY3VsYXRlX3NpbWlsYXJpdHkodXNlcl9wcm9maWxlLnJlc3VsdC52YWx1ZXMsIGNhbmRpZGF0ZS5wcm9maWxlLnJlc3VsdC52YWx1ZXMsIDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUucHJvZmlsZVtcIm5lZWRzX3Njb3JlXCJdID0gbmVlZHNfc2NvcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1widmFsdWVzX3Njb3JlXCJdID0gdmFsdWVzX3Njb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0YWtlIGF2ZXJhZ2UgYW5kIGFkZCB0byBjYW5kaWRhdGUucHJvZmlsZSB1bmRlciBcImF2ZXJhZ2Vfc2NvcmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUucHJvZmlsZVtcImF2ZXJhZ2Vfc2NvcmVcIl0gPSAobmVlZHNfc2NvcmUgKyB2YWx1ZXNfc2NvcmUpIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHJldHVybiBlbGVjdGlvbnNcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7ZWxlY3Rpb25zfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFwcC5wdXQoJy9hcGkvc2xpZGUtcmVjb21tZW5kYXRpb25zLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgdXNlcl9wcm9maWxlID0gcmVxLmJvZHkudXNlcjtcbiAgICAgICAgICAgIGNvbnN0IGVsZWN0aW9ucyA9IHJlcS5ib2R5LmVsZWN0aW9ucztcblxuICAgICAgICAgICAgZm9yIChlbGVjdGlvbiBvZiBlbGVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNhbmRpZGF0ZV9wcm9maWxlcyA9W107XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBjYW5kaWRhdGVzJyBwcm9maWxlcyBmcm9tIGVsZWN0aW9uIG5vdCBzdG9yZWQgaW4gZmlyZWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNhbmRpZGF0ZSBvZiBlbGVjdGlvbi5jYW5kaWRhdGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2FuZGlkYXRlX2NvbnRlbnQgPSBcIlRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgYW5kIGhpcyBlbnRpcmUgZmFtaWx5IGhhdmUgYmVlbiBibGVzc2VkIHRvIGxpdmUgdGhlIEFtZXJpY2FuIERyZWFtIOKAlCB0aGUgaWRlYSB0aGF0IGFueW9uZSwgdGhyb3VnaCBoYXJkIHdvcmsgYW5kIGRldGVybWluYXRpb24sIGNhbiBhY2hpZXZlIGFueXRoaW5nLiBBbmQgaGUgaXMgY29tbWl0dGVkIHRvIGVuc3VyaW5nIGV2ZXJ5IGZhbWlseSBoYXMgdGhhdCBzYW1lIG9wcG9ydHVuaXR5LlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVQcm9maWxlUGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNhbmRpZGF0ZV9jb250ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1wdGlvblByZWZlcmVuY2VzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhd1Njb3JlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlID0gYXdhaXQgcGVyc29uYWxpdHlJbnNpZ2h0cy5wcm9maWxlKGNhbmRpZGF0ZVByb2ZpbGVQYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHByb2ZpbGUgdG8gY2FuZGlkYXRlIGpzb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZVtcInByb2ZpbGVcIl0gPSBwcm9maWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHByb2ZpbGUgdG8gY2FuZGlkYXRlIHByb2ZpbGVzIGZvciBzdG9yZSBpbiBmaXJlYmFzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlX3Byb2ZpbGVzLnB1c2gocHJvZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgbmVlZHNfc2NvcmUgYW5kIHZhbHVlc19zY29yZSB3aXRoIHVzZXJfcHJvZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVlZHNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUubmVlZHMsIGNhbmRpZGF0ZS5wcm9maWxlLnJlc3VsdC5uZWVkcywgMTIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzX3Njb3JlID0gY2FsY3VsYXRlX3NpbWlsYXJpdHkodXNlcl9wcm9maWxlLnZhbHVlcywgY2FuZGlkYXRlLnByb2ZpbGUucmVzdWx0LnZhbHVlcywgNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUucHJvZmlsZVtcIm5lZWRzX3Njb3JlXCJdID0gbmVlZHNfc2NvcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUucHJvZmlsZVtcInZhbHVlc19zY29yZVwiXSA9IHZhbHVlc19zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRha2UgYXZlcmFnZSBhbmQgYWRkIHRvIGNhbmRpZGF0ZS5wcm9maWxlIHVuZGVyIFwiYXZlcmFnZV9zY29yZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUucHJvZmlsZVtcImF2ZXJhZ2Vfc2NvcmVcIl0gPSAobmVlZHNfc2NvcmUgKyB2YWx1ZXNfc2NvcmUpIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZWxlY3Rpb25zXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtlbGVjdGlvbnN9KTtcbiAgICAgICAgICAgIH0pO1xuXG5cbi8vIFNUQVJUIFRIRSBTRVJWRVJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5jb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDgxO1xuYXBwLmxpc3Rlbihwb3J0KTtcblxuY29uc29sZS5sb2coYGxpc3RlbmluZyBvbjogJHtwb3J0fWApOyJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "express",
        "require",
        "cors",
        "morgan",
        "path",
        "bodyParser",
        "dotenv",
        "config",
        "silent",
        "app",
        "use",
        "set",
        "static",
        "join",
        "__dirname",
        "urlencoded",
        "extended",
        "json",
        "get",
        "req",
        "res",
        "docRef",
        "db",
        "collection",
        "doc",
        "first",
        "last",
        "born",
        "status",
        "send",
        "PersonalityInsightsV3",
        "IamAuthenticator",
        "personalityInsights",
        "version",
        "authenticator",
        "apikey",
        "process",
        "env",
        "IBMKEY",
        "serviceUrl",
        "calculate_similarity",
        "user",
        "candidate",
        "num",
        "per",
        "i",
        "Math",
        "min",
        "raw_score",
        "max",
        "put",
        "userProfileParams",
        "content",
        "body",
        "userText",
        "contentType",
        "consumptionPreferences",
        "rawScores",
        "user_profile",
        "profile",
        "elections",
        "election",
        "candidate_profiles",
        "candidates",
        "candidate_content",
        "candidateProfileParams",
        "push",
        "needs_score",
        "result",
        "needs",
        "values_score",
        "values",
        "error",
        "console",
        "log",
        "port",
        "PORT",
        "listen"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/catherineparnell/api-ivyhacks/src/",
      "sourcesContent": [
        "// import apiRouter from './router';\nconst express = require('express');\nconst cors = require('cors');\nconst morgan = require('morgan');\nconst path = require('path');\nconst bodyParser = require('body-parser');\n\nconst dotenv = require('dotenv');\ndotenv.config({ silent: true });\n\n// initialize\nconst app = express();\n\n// enable/disable cross origin resource sharing if necessary\napp.use(cors());\n\n// enable/disable http request logging\napp.use(morgan('dev'));\n\n// enable only if you want templating\napp.set('view engine', 'ejs');\n\n// enable only if you want static assets from folder static\napp.use(express.static('static'));\n\n// this just allows us to render ejs from the ../app/views directory\napp.set('views', path.join(__dirname, '../src/views'));\n\n// enable json message body for posting data to API\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\n\n// additional init stuff should go before hitting the routing\n\n// REGISTER OUR ROUTES -------------------------------\n// all of our routes will be prefixed with /api\n// this should go AFTER body parser\n// app.use('/api', apiRouter);\n\napp.get('/api/hello-world', async (req, res) => {\n    const docRef = db.collection('tests').doc('alovelace');\n\n    await docRef.set({\n        first: 'Ada',\n        last: 'Lovelace',\n        born: 1815\n    });\n    return res.status(200).send('Hello World!');\n});\n\nconst PersonalityInsightsV3 = require('ibm-watson/personality-insights/v3');\nconst { IamAuthenticator } = require('ibm-watson/auth');\n\nconst personalityInsights = new PersonalityInsightsV3({\n    version: '2017-10-13',\n    authenticator: new IamAuthenticator({\n      apikey: process.env.IBMKEY,\n    }),\n    serviceUrl: 'https://api.us-east.personality-insights.watson.cloud.ibm.com/instances/e243b357-33f5-45ec-a2e3-a4fdabccd55c',\n  });\n\n\nfunction calculate_similarity(user, candidate, num) {\n    let per = 0;\n    for (i = 0; i < num; i++) {\n        per += Math.min(user[i].raw_score, candidate[i].raw_score)/Math.max(user[i].raw_score, candidate[i].raw_score);\n    }\n    return (per / num)\n}\n\n\napp.put('/api/text-recommendations/', async (req, res) => {\n        // get user profile from ibm\n        const userProfileParams = {\n            // req.body.userText\n            content: req.body.userText,\n            contentType: 'text/plain;charset=utf-8',\n            consumptionPreferences: true,\n            rawScores: true,\n        };\n        let user_profile = await personalityInsights.profile(userProfileParams);\n    \n        // for each election in elections\n        // console.log(req.body.elections);\n        const elections = req.body.elections;\n        for (election of elections) {\n            // eslint-disable-next-line consistent-return\n                try {\n                    let candidate_profiles = [];\n                    // try and get candidates' profiles from election\n                            for (candidate of election.candidates) {\n                                let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\"\n                                const candidateProfileParams = {\n                                    content: candidate_content,\n                                    contentType: 'text/plain;charset=utf-8',\n                                    consumptionPreferences: true,\n                                    rawScores: true,\n                                };\n\n                                profile = await personalityInsights.profile(candidateProfileParams);\n                                // add profile to candidate json\n                                candidate[\"profile\"] = profile;\n                                // add profile to candidate profiles for store in firebase\n                                candidate_profiles.push(profile);\n                                // calculate needs_score and values_score with user_profile\n                                const needs_score = calculate_similarity(user_profile.result.needs, candidate.profile.result.needs, 12);\n                                const values_score = calculate_similarity(user_profile.result.values, candidate.profile.result.values, 5);\n                                candidate.profile[\"needs_score\"] = needs_score;\n                                candidate.profile[\"values_score\"] = values_score;\n                                // take average and add to candidate.profile under \"average_score\"\n                                candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n                            }\n                        } catch (error) {\n                            console.log(error);\n                            return res.status(500).send(error);\n                        } \n            }\n            // return elections\n            return res.status(200).send({elections});\n        });\n\n        app.put('/api/slide-recommendations/', async (req, res) => {\n            const user_profile = req.body.user;\n            const elections = req.body.elections;\n\n            for (election of elections) {\n                // eslint-disable-next-line consistent-return                 \n                        let candidate_profiles =[];\n                        // if candidates' profiles from election not stored in firebase\n                            try {\n                                for (candidate of election.candidates) {\n                                    let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\"\n                                    const candidateProfileParams = {\n                                        content: candidate_content,\n                                        contentType: 'text/plain;charset=utf-8',\n                                        consumptionPreferences: true,\n                                        rawScores: true,\n                                    };\n    \n                                    profile = await personalityInsights.profile(candidateProfileParams);\n                                    // add profile to candidate json\n                                    candidate[\"profile\"] = profile;\n                                    // add profile to candidate profiles for store in firebase\n                                    candidate_profiles.push(profile);\n                                    // calculate needs_score and values_score with user_profile\n                                    const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n                                    const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n                                    candidate.profile[\"needs_score\"] = needs_score;\n                                    candidate.profile[\"values_score\"] = values_score;\n                                    // take average and add to candidate.profile under \"average_score\"\n                                    candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n                                }\n                            } catch (error) {\n                                console.log(error);\n                                return res.status(500).send(error);\n                            } \n                }\n                // return elections\n                return res.status(200).send({elections});\n            });\n\n\n// START THE SERVER\n// =============================================================================\nconst port = process.env.PORT || 8081;\napp.listen(port);\n\nconsole.log(`listening on: ${port}`);"
      ]
    },
    "sourceType": "module",
    "mtime": 1601834861192
  },
  "{\"sourceRoot\":\"/Users/sathvika/Desktop/api-ivyhacks/src/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/Users/sathvika/Desktop/api-ivyhacks\",\"filename\":\"/Users/sathvika/Desktop/api-ivyhacks/src/server.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/sathvika/Desktop/api-ivyhacks\",\"plugins\":[],\"presets\":[]}:7.11.6": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/sathvika/Desktop/api-ivyhacks/src/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/Users/sathvika/Desktop/api-ivyhacks",
      "filename": "/Users/sathvika/Desktop/api-ivyhacks/src/server.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/sathvika/Desktop/api-ivyhacks",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/sathvika/Desktop/api-ivyhacks/src/server.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/Users/sathvika/Desktop/api-ivyhacks/src/server.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/sathvika/Desktop/api-ivyhacks/src/",
        "sourceFileName": "server.js"
      }
    },
    "ast": null,
    "code": "// import apiRouter from './router';\nconst express = require('express');\n\nconst cors = require('cors');\n\nconst morgan = require('morgan');\n\nconst path = require('path');\n\nconst bodyParser = require('body-parser');\n\nconst dotenv = require('dotenv');\n\ndotenv.config({\n  silent: true\n}); // initialize\n\nconst app = express();\n\nconst admin = require('firebase-admin');\n\nconst serviceAccount = require('../permissions.json');\n\nconst Apify = require('apify');\n\nApify.client.setOptions({\n  token: 'HPHxehsbm8m2t4iEvWpu8sFeJ'\n});\n\nconst axios = require('axios');\n\nlet data = '';\nconst config = {\n  method: 'get',\n  url: 'https://api.apify.com/v2/acts/pocesar~facebook-pages-scraper/runs/last/dataset/items?token=HPHxehsbm8m2t4iEvWpu8sFeJ\\n',\n  headers: {\n    Cookie: 'AWSALB=CJFq9Ff621KPwyrNjrbVdikBoCaXzEvywP4PU+TEED2YEJEufiqiHIJAhSUBW2ms67c1AebTxKBUC07L49dZ7HKeF4wersmImyHNVpMN6MrtIYQc5iEteMxFCd1r; AWSALBCORS=CJFq9Ff621KPwyrNjrbVdikBoCaXzEvywP4PU+TEED2YEJEufiqiHIJAhSUBW2ms67c1AebTxKBUC07L49dZ7HKeF4wersmImyHNVpMN6MrtIYQc5iEteMxFCd1r'\n  },\n  data\n};\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount)\n});\nconst db = admin.firestore(); // enable/disable cross origin resource sharing if necessary\n\napp.use(cors()); // enable/disable http request logging\n\napp.use(morgan('dev')); // enable only if you want templating\n\napp.set('view engine', 'ejs'); // enable only if you want static assets from folder static\n\napp.use(express.static('static')); // this just allows us to render ejs from the ../app/views directory\n\napp.set('views', path.join(__dirname, '../src/views')); // enable json message body for posting data to API\n\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.use(bodyParser.json()); // additional init stuff should go before hitting the routing\n// REGISTER OUR ROUTES -------------------------------\n// all of our routes will be prefixed with /api\n// this should go AFTER body parser\n// app.use('/api', apiRouter);\n\napp.get('/api/hello-world', async (req, res) => {\n  const docRef = db.collection('tests').doc('alovelace');\n  await docRef.set({\n    first: 'Ada',\n    last: 'Lovelace',\n    born: 1815\n  });\n  return res.status(200).send('Hello World!');\n});\n\nconst PersonalityInsightsV3 = require('ibm-watson/personality-insights/v3');\n\nconst {\n  IamAuthenticator\n} = require('ibm-watson/auth');\n\nconst personalityInsights = new PersonalityInsightsV3({\n  version: '2017-10-13',\n  authenticator: new IamAuthenticator({\n    apikey: process.env.IBMKEY\n  }),\n  serviceUrl: 'https://api.us-east.personality-insights.watson.cloud.ibm.com/instances/e243b357-33f5-45ec-a2e3-a4fdabccd55c'\n});\n\nfunction calculate_similarity(user, candidate, num) {\n  let per = 0;\n\n  for (i = 0; i < num; i++) {\n    per += Math.min(user[i].raw_score, candidate[i].raw_score) / Math.max(user[i].raw_score, candidate[i].raw_score);\n  }\n\n  return per / num;\n}\n\napp.put('/api/text-recommendations/', async (req, res) => {\n  // get user profile from ibm\n  const userProfileParams = {\n    // req.body.userText\n    content: req.body.userText,\n    contentType: 'text/plain;charset=utf-8',\n    consumptionPreferences: true,\n    rawScores: true\n  };\n  let user_profile = await personalityInsights.profile(userProfileParams); // for each election in elections\n  // console.log(req.body.elections);\n\n  const elections = req.body.elections;\n\n  for (election of elections) {\n    // eslint-disable-next-line consistent-return\n    try {\n      // string parse input for election_id\n      const election_id = election.candidates[0].name + election.district.name;\n      let candidate_profiles = []; // try and get candidates' profiles from election\n\n      for (candidate of election.candidates) {\n        let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\";\n        const candidateProfileParams = {\n          content: candidate_content,\n          contentType: 'text/plain;charset=utf-8',\n          consumptionPreferences: true,\n          rawScores: true\n        };\n        profile = await personalityInsights.profile(candidateProfileParams); // add profile to candidate json\n\n        candidate[\"profile\"] = profile; // add profile to candidate profiles for store in firebase\n\n        candidate_profiles.push(profile); // calculate needs_score and values_score with user_profile\n\n        const needs_score = calculate_similarity(user_profile.result.needs, candidate.profile.result.needs, 12);\n        const values_score = calculate_similarity(user_profile.result.values, candidate.profile.result.values, 5);\n        candidate.profile[\"needs_score\"] = needs_score;\n        candidate.profile[\"values_score\"] = values_score; // take average and add to candidate.profile under \"average_score\"\n\n        candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n      }\n    } catch (error) {\n      console.log(error);\n      return res.status(500).send(error);\n    }\n  } // return elections\n\n\n  return res.status(200).send({\n    elections\n  });\n});\napp.put('/api/slide-recommendations/', async (req, res) => {\n  const user_profile = req.body.user; // for each election in elections\n  // console.log(req.body.elections);\n\n  const elections = req.body.elections;\n\n  for (election of elections) {\n    // eslint-disable-next-line consistent-return\n    try {\n      // string parse input for election_id\n      const election_id = election.candidates[0].name + election.district.name; // try and get candidates' profiles from election\n\n      const document = db.collection('elections').doc(election_id);\n      let item = await document.get();\n      let candidate_profiles = []; // if candidates' profiles from election not stored in firebase\n\n      if (!item.exists) {\n        try {\n          for (candidate of election.candidates) {\n            let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\";\n            const candidateProfileParams = {\n              content: candidate_content,\n              contentType: 'text/plain;charset=utf-8',\n              consumptionPreferences: true,\n              rawScores: true\n            };\n            profile = await personalityInsights.profile(candidateProfileParams); // add profile to candidate json\n\n            candidate[\"profile\"] = profile; // add profile to candidate profiles for store in firebase\n\n            candidate_profiles.push(profile); // calculate needs_score and values_score with user_profile\n\n            const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n            const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n            candidate.profile[\"needs_score\"] = needs_score;\n            candidate.profile[\"values_score\"] = values_score; // take average and add to candidate.profile under \"average_score\"\n\n            candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n          } // create elections entry in firebase\n\n\n          console.log(\"candidate_profiles\", candidate_profiles);\n          await db.collection('elections').doc('/' + election_id + '/').create({\n            election: candidate_profiles\n          });\n        } catch (error) {\n          console.log(error);\n          return res.status(500).send(error);\n        } // if candidates' profiles already stored in firebase\n\n      } else {\n        // response = {election: candidate_profiles}\n        let response = item.data();\n        let candidate_profiles = response.election;\n\n        for (candidate_profile of candidate_profiles) {\n          // calculate needs_score and values_score with user_profile\n          const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n          const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n          candidate_profile[\"needs_score\"] = needs_score;\n          candidate_profile[\"values_score\"] = values_score; // take average and add to candidate.profile under \"average_score\"\n\n          candidate_profile[\"average_score\"] = (needs_score + values_score) / 2; // add profile to candidate json\n\n          candidate[\"profile\"] = candidate_profile;\n        }\n      }\n    } catch (error) {\n      console.log(error);\n      return res.status(500).send(error);\n    }\n\n    ;\n  } // return elections\n\n\n  return res.status(200).send({\n    elections\n  });\n}); // START THE SERVER\n// =============================================================================\n\nconst port = process.env.PORT || 8081;\napp.listen(port);\nconsole.log(`listening on: ${port}`);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJtb3JnYW4iLCJwYXRoIiwiYm9keVBhcnNlciIsImRvdGVudiIsImNvbmZpZyIsInNpbGVudCIsImFwcCIsImFkbWluIiwic2VydmljZUFjY291bnQiLCJBcGlmeSIsImNsaWVudCIsInNldE9wdGlvbnMiLCJ0b2tlbiIsImF4aW9zIiwiZGF0YSIsIm1ldGhvZCIsInVybCIsImhlYWRlcnMiLCJDb29raWUiLCJpbml0aWFsaXplQXBwIiwiY3JlZGVudGlhbCIsImNlcnQiLCJkYiIsImZpcmVzdG9yZSIsInVzZSIsInNldCIsInN0YXRpYyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJqc29uIiwiZ2V0IiwicmVxIiwicmVzIiwiZG9jUmVmIiwiY29sbGVjdGlvbiIsImRvYyIsImZpcnN0IiwibGFzdCIsImJvcm4iLCJzdGF0dXMiLCJzZW5kIiwiUGVyc29uYWxpdHlJbnNpZ2h0c1YzIiwiSWFtQXV0aGVudGljYXRvciIsInBlcnNvbmFsaXR5SW5zaWdodHMiLCJ2ZXJzaW9uIiwiYXV0aGVudGljYXRvciIsImFwaWtleSIsInByb2Nlc3MiLCJlbnYiLCJJQk1LRVkiLCJzZXJ2aWNlVXJsIiwiY2FsY3VsYXRlX3NpbWlsYXJpdHkiLCJ1c2VyIiwiY2FuZGlkYXRlIiwibnVtIiwicGVyIiwiaSIsIk1hdGgiLCJtaW4iLCJyYXdfc2NvcmUiLCJtYXgiLCJwdXQiLCJ1c2VyUHJvZmlsZVBhcmFtcyIsImNvbnRlbnQiLCJib2R5IiwidXNlclRleHQiLCJjb250ZW50VHlwZSIsImNvbnN1bXB0aW9uUHJlZmVyZW5jZXMiLCJyYXdTY29yZXMiLCJ1c2VyX3Byb2ZpbGUiLCJwcm9maWxlIiwiZWxlY3Rpb25zIiwiZWxlY3Rpb24iLCJlbGVjdGlvbl9pZCIsImNhbmRpZGF0ZXMiLCJuYW1lIiwiZGlzdHJpY3QiLCJjYW5kaWRhdGVfcHJvZmlsZXMiLCJjYW5kaWRhdGVfY29udGVudCIsImNhbmRpZGF0ZVByb2ZpbGVQYXJhbXMiLCJwdXNoIiwibmVlZHNfc2NvcmUiLCJyZXN1bHQiLCJuZWVkcyIsInZhbHVlc19zY29yZSIsInZhbHVlcyIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImRvY3VtZW50IiwiaXRlbSIsImV4aXN0cyIsImNyZWF0ZSIsInJlc3BvbnNlIiwiY2FuZGlkYXRlX3Byb2ZpbGUiLCJwb3J0IiwiUE9SVCIsImxpc3RlbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXZCOztBQUNBLE1BQU1DLElBQUksR0FBR0QsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsUUFBRCxDQUF0Qjs7QUFDQSxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1JLFVBQVUsR0FBR0osT0FBTyxDQUFDLGFBQUQsQ0FBMUI7O0FBRUEsTUFBTUssTUFBTSxHQUFHTCxPQUFPLENBQUMsUUFBRCxDQUF0Qjs7QUFDQUssTUFBTSxDQUFDQyxNQUFQLENBQWM7QUFBRUMsRUFBQUEsTUFBTSxFQUFFO0FBQVYsQ0FBZCxFLENBRUE7O0FBQ0EsTUFBTUMsR0FBRyxHQUFHVCxPQUFPLEVBQW5COztBQUVBLE1BQU1VLEtBQUssR0FBR1QsT0FBTyxDQUFDLGdCQUFELENBQXJCOztBQUVBLE1BQU1VLGNBQWMsR0FBR1YsT0FBTyxDQUFDLHFCQUFELENBQTlCOztBQUVBLE1BQU1XLEtBQUssR0FBR1gsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBRUFXLEtBQUssQ0FBQ0MsTUFBTixDQUFhQyxVQUFiLENBQXdCO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQXhCOztBQUVBLE1BQU1DLEtBQUssR0FBR2YsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBRUEsSUFBSWdCLElBQUksR0FBRyxFQUFYO0FBRUEsTUFBTVYsTUFBTSxH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O0FBQUE7QUFDSixHQXJFa0QsQ0FzRW5EOzs7QUFDQSxTQUFPdEQsR0FBRyxDQUFDTyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFBQytCLElBQUFBO0FBQUQsR0FBckIsQ0FBUDtBQUNILENBeEVMLEUsQ0EyRVI7QUFDQTs7QUFDQSxNQUFNd0IsSUFBSSxHQUFHaEQsT0FBTyxDQUFDQyxHQUFSLENBQVlnRCxJQUFaLElBQW9CLElBQWpDO0FBQ0E1RixHQUFHLENBQUM2RixNQUFKLENBQVdGLElBQVg7QUFFQVIsT0FBTyxDQUFDQyxHQUFSLENBQWEsaUJBQWdCTyxJQUFLLEVBQWxDIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9zYXRodmlrYS9EZXNrdG9wL2FwaS1pdnloYWNrcy9zcmMvIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IGFwaVJvdXRlciBmcm9tICcuL3JvdXRlcic7XG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcbmNvbnN0IG1vcmdhbiA9IHJlcXVpcmUoJ21vcmdhbicpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xuXG5jb25zdCBkb3RlbnYgPSByZXF1aXJlKCdkb3RlbnYnKTtcbmRvdGVudi5jb25maWcoeyBzaWxlbnQ6IHRydWUgfSk7XG5cbi8vIGluaXRpYWxpemVcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuY29uc3QgYWRtaW4gPSByZXF1aXJlKCdmaXJlYmFzZS1hZG1pbicpO1xuXG5jb25zdCBzZXJ2aWNlQWNjb3VudCA9IHJlcXVpcmUoJy4uL3Blcm1pc3Npb25zLmpzb24nKTtcblxuY29uc3QgQXBpZnkgPSByZXF1aXJlKCdhcGlmeScpO1xuXG5BcGlmeS5jbGllbnQuc2V0T3B0aW9ucyh7IHRva2VuOiAnSFBIeGVoc2JtOG0ydDRpRXZXcHU4c0ZlSicgfSk7XG5cbmNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKTtcblxubGV0IGRhdGEgPSAnJztcblxuY29uc3QgY29uZmlnID0ge1xuICBtZXRob2Q6ICdnZXQnLFxuICB1cmw6ICdodHRwczovL2FwaS5hcGlmeS5jb20vdjIvYWN0cy9wb2Nlc2FyfmZhY2Vib29rLXBhZ2VzLXNjcmFwZXIvcnVucy9sYXN0L2RhdGFzZXQvaXRlbXM/dG9rZW49SFBIeGVoc2JtOG0ydDRpRXZXcHU4c0ZlSlxcbicsXG4gIGhlYWRlcnM6IHtcbiAgICBDb29raWU6ICdBV1NBTEI9Q0pGcTlGZjYyMUtQd3lyTmpyYlZkaWtCb0NhWHpFdnl3UDRQVStURUVEMllFSkV1ZmlxaUhJSkFoU1VCVzJtczY3YzFBZWJUeEtCVUMwN0w0OWRaN0hLZUY0d2Vyc21JbXlITlZwTU42TXJ0SVlRYzVpRXRlTXhGQ2QxcjsgQVdTQUxCQ09SUz1DSkZxOUZmNjIxS1B3eXJOanJiVmRpa0JvQ2FYekV2eXdQNFBVK1RFRUQyWUVKRXVmaXFpSElKQWhTVUJXMm1zNjdjMUFlYlR4S0JVQzA3TDQ5ZFo3SEtlRjR3ZXJzbUlteUhOVnBNTjZNcnRJWVFjNWlFdGVNeEZDZDFyJyxcbiAgfSxcbiAgZGF0YSxcbn07XG5cbmFkbWluLmluaXRpYWxpemVBcHAoe1xuICBjcmVkZW50aWFsOiBhZG1pbi5jcmVkZW50aWFsLmNlcnQoc2VydmljZUFjY291bnQpXG59KTtcblxuY29uc3QgZGIgPSBhZG1pbi5maXJlc3RvcmUoKTtcblxuLy8gZW5hYmxlL2Rpc2FibGUgY3Jvc3Mgb3JpZ2luIHJlc291cmNlIHNoYXJpbmcgaWYgbmVjZXNzYXJ5XG5hcHAudXNlKGNvcnMoKSk7XG5cbi8vIGVuYWJsZS9kaXNhYmxlIGh0dHAgcmVxdWVzdCBsb2dnaW5nXG5hcHAudXNlKG1vcmdhbignZGV2JykpO1xuXG4vLyBlbmFibGUgb25seSBpZiB5b3Ugd2FudCB0ZW1wbGF0aW5nXG5hcHAuc2V0KCd2aWV3IGVuZ2luZScsICdlanMnKTtcblxuLy8gZW5hYmxlIG9ubHkgaWYgeW91IHdhbnQgc3RhdGljIGFzc2V0cyBmcm9tIGZvbGRlciBzdGF0aWNcbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMoJ3N0YXRpYycpKTtcblxuLy8gdGhpcyBqdXN0IGFsbG93cyB1cyB0byByZW5kZXIgZWpzIGZyb20gdGhlIC4uL2FwcC92aWV3cyBkaXJlY3RvcnlcbmFwcC5zZXQoJ3ZpZXdzJywgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3NyYy92aWV3cycpKTtcblxuLy8gZW5hYmxlIGpzb24gbWVzc2FnZSBib2R5IGZvciBwb3N0aW5nIGRhdGEgdG8gQVBJXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuXG4vLyBhZGRpdGlvbmFsIGluaXQgc3R1ZmYgc2hvdWxkIGdvIGJlZm9yZSBoaXR0aW5nIHRoZSByb3V0aW5nXG5cbi8vIFJFR0lTVEVSIE9VUiBST1VURVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gYWxsIG9mIG91ciByb3V0ZXMgd2lsbCBiZSBwcmVmaXhlZCB3aXRoIC9hcGlcbi8vIHRoaXMgc2hvdWxkIGdvIEFGVEVSIGJvZHkgcGFyc2VyXG4vLyBhcHAudXNlKCcvYXBpJywgYXBpUm91dGVyKTtcblxuYXBwLmdldCgnL2FwaS9oZWxsby13b3JsZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIGNvbnN0IGRvY1JlZiA9IGRiLmNvbGxlY3Rpb24oJ3Rlc3RzJykuZG9jKCdhbG92ZWxhY2UnKTtcblxuICAgIGF3YWl0IGRvY1JlZi5zZXQoe1xuICAgICAgICBmaXJzdDogJ0FkYScsXG4gICAgICAgIGxhc3Q6ICdMb3ZlbGFjZScsXG4gICAgICAgIGJvcm46IDE4MTVcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoJ0hlbGxvIFdvcmxkIScpO1xufSk7XG5cbmNvbnN0IFBlcnNvbmFsaXR5SW5zaWdodHNWMyA9IHJlcXVpcmUoJ2libS13YXRzb24vcGVyc29uYWxpdHktaW5zaWdodHMvdjMnKTtcbmNvbnN0IHsgSWFtQXV0aGVudGljYXRvciB9ID0gcmVxdWlyZSgnaWJtLXdhdHNvbi9hdXRoJyk7XG5cbmNvbnN0IHBlcnNvbmFsaXR5SW5zaWdodHMgPSBuZXcgUGVyc29uYWxpdHlJbnNpZ2h0c1YzKHtcbiAgICB2ZXJzaW9uOiAnMjAxNy0xMC0xMycsXG4gICAgYXV0aGVudGljYXRvcjogbmV3IElhbUF1dGhlbnRpY2F0b3Ioe1xuICAgICAgYXBpa2V5OiBwcm9jZXNzLmVudi5JQk1LRVksXG4gICAgfSksXG4gICAgc2VydmljZVVybDogJ2h0dHBzOi8vYXBpLnVzLWVhc3QucGVyc29uYWxpdHktaW5zaWdodHMud2F0c29uLmNsb3VkLmlibS5jb20vaW5zdGFuY2VzL2UyNDNiMzU3LTMzZjUtNDVlYy1hMmUzLWE0ZmRhYmNjZDU1YycsXG4gIH0pO1xuXG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaW1pbGFyaXR5KHVzZXIsIGNhbmRpZGF0ZSwgbnVtKSB7XG4gICAgbGV0IHBlciA9IDA7XG4gICAgZm9yIChpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgICAgIHBlciArPSBNYXRoLm1pbih1c2VyW2ldLnJhd19zY29yZSwgY2FuZGlkYXRlW2ldLnJhd19zY29yZSkvTWF0aC5tYXgodXNlcltpXS5yYXdfc2NvcmUsIGNhbmRpZGF0ZVtpXS5yYXdfc2NvcmUpO1xuICAgIH1cbiAgICByZXR1cm4gKHBlciAvIG51bSlcbn1cblxuXG5hcHAucHV0KCcvYXBpL3RleHQtcmVjb21tZW5kYXRpb25zLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuXG4gICAgICAgIC8vIGdldCB1c2VyIHByb2ZpbGUgZnJvbSBpYm1cbiAgICAgICAgY29uc3QgdXNlclByb2ZpbGVQYXJhbXMgPSB7XG4gICAgICAgICAgICAvLyByZXEuYm9keS51c2VyVGV4dFxuICAgICAgICAgICAgY29udGVudDogcmVxLmJvZHkudXNlclRleHQsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcsXG4gICAgICAgICAgICBjb25zdW1wdGlvblByZWZlcmVuY2VzOiB0cnVlLFxuICAgICAgICAgICAgcmF3U2NvcmVzOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBsZXQgdXNlcl9wcm9maWxlID0gYXdhaXQgcGVyc29uYWxpdHlJbnNpZ2h0cy5wcm9maWxlKHVzZXJQcm9maWxlUGFyYW1zKTtcbiAgICBcbiAgICAgICAgLy8gZm9yIGVhY2ggZWxlY3Rpb24gaW4gZWxlY3Rpb25zXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcS5ib2R5LmVsZWN0aW9ucyk7XG4gICAgICAgIGNvbnN0IGVsZWN0aW9ucyA9IHJlcS5ib2R5LmVsZWN0aW9ucztcbiAgICAgICAgZm9yIChlbGVjdGlvbiBvZiBlbGVjdGlvbnMpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVyblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0cmluZyBwYXJzZSBpbnB1dCBmb3IgZWxlY3Rpb25faWRcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlY3Rpb25faWQgPSBlbGVjdGlvbi5jYW5kaWRhdGVzWzBdLm5hbWUgKyBlbGVjdGlvbi5kaXN0cmljdC5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBsZXQgY2FuZGlkYXRlX3Byb2ZpbGVzID0gW11cbiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IGFuZCBnZXQgY2FuZGlkYXRlcycgcHJvZmlsZXMgZnJvbSBlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY2FuZGlkYXRlIG9mIGVsZWN0aW9uLmNhbmRpZGF0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNhbmRpZGF0ZV9jb250ZW50ID0gXCJUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIGFuZCBoaXMgZW50aXJlIGZhbWlseSBoYXZlIGJlZW4gYmxlc3NlZCB0byBsaXZlIHRoZSBBbWVyaWNhbiBEcmVhbSDigJQgdGhlIGlkZWEgdGhhdCBhbnlvbmUsIHRocm91Z2ggaGFyZCB3b3JrIGFuZCBkZXRlcm1pbmF0aW9uLCBjYW4gYWNoaWV2ZSBhbnl0aGluZy4gQW5kIGhlIGlzIGNvbW1pdHRlZCB0byBlbnN1cmluZyBldmVyeSBmYW1pbHkgaGFzIHRoYXQgc2FtZSBvcHBvcnR1bml0eS5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVQcm9maWxlUGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY2FuZGlkYXRlX2NvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1wdGlvblByZWZlcmVuY2VzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF3U2NvcmVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGUgPSBhd2FpdCBwZXJzb25hbGl0eUluc2lnaHRzLnByb2ZpbGUoY2FuZGlkYXRlUHJvZmlsZVBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBwcm9maWxlIHRvIGNhbmRpZGF0ZSBqc29uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZVtcInByb2ZpbGVcIl0gPSBwcm9maWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcHJvZmlsZSB0byBjYW5kaWRhdGUgcHJvZmlsZXMgZm9yIHN0b3JlIGluIGZpcmViYXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZV9wcm9maWxlcy5wdXNoKHByb2ZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgbmVlZHNfc2NvcmUgYW5kIHZhbHVlc19zY29yZSB3aXRoIHVzZXJfcHJvZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWVkc19zY29yZSA9IGNhbGN1bGF0ZV9zaW1pbGFyaXR5KHVzZXJfcHJvZmlsZS5yZXN1bHQubmVlZHMsIGNhbmRpZGF0ZS5wcm9maWxlLnJlc3VsdC5uZWVkcywgMTIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUucmVzdWx0LnZhbHVlcywgY2FuZGlkYXRlLnByb2ZpbGUucmVzdWx0LnZhbHVlcywgNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1wibmVlZHNfc2NvcmVcIl0gPSBuZWVkc19zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlLnByb2ZpbGVbXCJ2YWx1ZXNfc2NvcmVcIl0gPSB2YWx1ZXNfc2NvcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRha2UgYXZlcmFnZSBhbmQgYWRkIHRvIGNhbmRpZGF0ZS5wcm9maWxlIHVuZGVyIFwiYXZlcmFnZV9zY29yZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1wiYXZlcmFnZV9zY29yZVwiXSA9IChuZWVkc19zY29yZSArIHZhbHVlc19zY29yZSkgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gcmV0dXJuIGVsZWN0aW9uc1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtlbGVjdGlvbnN9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXBwLnB1dCgnL2FwaS9zbGlkZS1yZWNvbW1lbmRhdGlvbnMvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB1c2VyX3Byb2ZpbGUgPSByZXEuYm9keS51c2VyO1xuICAgICAgICAgICAgLy8gZm9yIGVhY2ggZWxlY3Rpb24gaW4gZWxlY3Rpb25zXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXEuYm9keS5lbGVjdGlvbnMpO1xuICAgICAgICAgICAgY29uc3QgZWxlY3Rpb25zID0gcmVxLmJvZHkuZWxlY3Rpb25zO1xuICAgICAgICAgICAgZm9yIChlbGVjdGlvbiBvZiBlbGVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cmluZyBwYXJzZSBpbnB1dCBmb3IgZWxlY3Rpb25faWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZWN0aW9uX2lkID0gZWxlY3Rpb24uY2FuZGlkYXRlc1swXS5uYW1lICsgZWxlY3Rpb24uZGlzdHJpY3QubmFtZTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0cnkgYW5kIGdldCBjYW5kaWRhdGVzJyBwcm9maWxlcyBmcm9tIGVsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGRiLmNvbGxlY3Rpb24oJ2VsZWN0aW9ucycpLmRvYyhlbGVjdGlvbl9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGF3YWl0IGRvY3VtZW50LmdldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNhbmRpZGF0ZV9wcm9maWxlcyA9W107XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBjYW5kaWRhdGVzJyBwcm9maWxlcyBmcm9tIGVsZWN0aW9uIG5vdCBzdG9yZWQgaW4gZmlyZWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXRlbS5leGlzdHMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY2FuZGlkYXRlIG9mIGVsZWN0aW9uLmNhbmRpZGF0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjYW5kaWRhdGVfY29udGVudCA9IFwiVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBUZWQsIGhpcyB3aWZlIEhlaWRpLCB0aGVpciB0d28gZGF1Z2h0ZXJzIENhcm9saW5lIGFuZCBDYXRoZXJpbmUsIFRlZCwgaGlzIHdpZmUgSGVpZGksIHRoZWlyIHR3byBkYXVnaHRlcnMgQ2Fyb2xpbmUgYW5kIENhdGhlcmluZSwgVGVkLCBoaXMgd2lmZSBIZWlkaSwgdGhlaXIgdHdvIGRhdWdodGVycyBDYXJvbGluZSBhbmQgQ2F0aGVyaW5lLCBhbmQgaGlzIGVudGlyZSBmYW1pbHkgaGF2ZSBiZWVuIGJsZXNzZWQgdG8gbGl2ZSB0aGUgQW1lcmljYW4gRHJlYW0g4oCUIHRoZSBpZGVhIHRoYXQgYW55b25lLCB0aHJvdWdoIGhhcmQgd29yayBhbmQgZGV0ZXJtaW5hdGlvbiwgY2FuIGFjaGlldmUgYW55dGhpbmcuIEFuZCBoZSBpcyBjb21taXR0ZWQgdG8gZW5zdXJpbmcgZXZlcnkgZmFtaWx5IGhhcyB0aGF0IHNhbWUgb3Bwb3J0dW5pdHkuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZVByb2ZpbGVQYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY2FuZGlkYXRlX2NvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bXB0aW9uUHJlZmVyZW5jZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF3U2NvcmVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGUgPSBhd2FpdCBwZXJzb25hbGl0eUluc2lnaHRzLnByb2ZpbGUoY2FuZGlkYXRlUHJvZmlsZVBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcHJvZmlsZSB0byBjYW5kaWRhdGUganNvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlW1wicHJvZmlsZVwiXSA9IHByb2ZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcHJvZmlsZSB0byBjYW5kaWRhdGUgcHJvZmlsZXMgZm9yIHN0b3JlIGluIGZpcmViYXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVfcHJvZmlsZXMucHVzaChwcm9maWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBuZWVkc19zY29yZSBhbmQgdmFsdWVzX3Njb3JlIHdpdGggdXNlcl9wcm9maWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWVkc19zY29yZSA9IGNhbGN1bGF0ZV9zaW1pbGFyaXR5KHVzZXJfcHJvZmlsZS5uZWVkcywgY2FuZGlkYXRlLnByb2ZpbGUucmVzdWx0Lm5lZWRzLCAxMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUudmFsdWVzLCBjYW5kaWRhdGUucHJvZmlsZS5yZXN1bHQudmFsdWVzLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1wibmVlZHNfc2NvcmVcIl0gPSBuZWVkc19zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1widmFsdWVzX3Njb3JlXCJdID0gdmFsdWVzX3Njb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGFrZSBhdmVyYWdlIGFuZCBhZGQgdG8gY2FuZGlkYXRlLnByb2ZpbGUgdW5kZXIgXCJhdmVyYWdlX3Njb3JlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZS5wcm9maWxlW1wiYXZlcmFnZV9zY29yZVwiXSA9IChuZWVkc19zY29yZSArIHZhbHVlc19zY29yZSkgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBlbGVjdGlvbnMgZW50cnkgaW4gZmlyZWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjYW5kaWRhdGVfcHJvZmlsZXNcIiwgY2FuZGlkYXRlX3Byb2ZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignZWxlY3Rpb25zJykuZG9jKCcvJyArIGVsZWN0aW9uX2lkICsgJy8nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZSh7ZWxlY3Rpb246IGNhbmRpZGF0ZV9wcm9maWxlc30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgY2FuZGlkYXRlcycgcHJvZmlsZXMgYWxyZWFkeSBzdG9yZWQgaW4gZmlyZWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVzcG9uc2UgPSB7ZWxlY3Rpb246IGNhbmRpZGF0ZV9wcm9maWxlc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBpdGVtLmRhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2FuZGlkYXRlX3Byb2ZpbGVzID0gcmVzcG9uc2UuZWxlY3Rpb247XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjYW5kaWRhdGVfcHJvZmlsZSBvZiBjYW5kaWRhdGVfcHJvZmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIG5lZWRzX3Njb3JlIGFuZCB2YWx1ZXNfc2NvcmUgd2l0aCB1c2VyX3Byb2ZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVlZHNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUubmVlZHMsIGNhbmRpZGF0ZS5wcm9maWxlLnJlc3VsdC5uZWVkcywgMTIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXNfc2NvcmUgPSBjYWxjdWxhdGVfc2ltaWxhcml0eSh1c2VyX3Byb2ZpbGUudmFsdWVzLCBjYW5kaWRhdGUucHJvZmlsZS5yZXN1bHQudmFsdWVzLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlX3Byb2ZpbGVbXCJuZWVkc19zY29yZVwiXSA9IG5lZWRzX3Njb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVfcHJvZmlsZVtcInZhbHVlc19zY29yZVwiXSA9IHZhbHVlc19zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGFrZSBhdmVyYWdlIGFuZCBhZGQgdG8gY2FuZGlkYXRlLnByb2ZpbGUgdW5kZXIgXCJhdmVyYWdlX3Njb3JlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlX3Byb2ZpbGVbXCJhdmVyYWdlX3Njb3JlXCJdID0gKG5lZWRzX3Njb3JlICsgdmFsdWVzX3Njb3JlKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBwcm9maWxlIHRvIGNhbmRpZGF0ZSBqc29uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZVtcInByb2ZpbGVcIl0gPSBjYW5kaWRhdGVfcHJvZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZWxlY3Rpb25zXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtlbGVjdGlvbnN9KTtcbiAgICAgICAgICAgIH0pO1xuXG5cbi8vIFNUQVJUIFRIRSBTRVJWRVJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5jb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDgxO1xuYXBwLmxpc3Rlbihwb3J0KTtcblxuY29uc29sZS5sb2coYGxpc3RlbmluZyBvbjogJHtwb3J0fWApOyJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "express",
        "require",
        "cors",
        "morgan",
        "path",
        "bodyParser",
        "dotenv",
        "config",
        "silent",
        "app",
        "admin",
        "serviceAccount",
        "Apify",
        "client",
        "setOptions",
        "token",
        "axios",
        "data",
        "method",
        "url",
        "headers",
        "Cookie",
        "initializeApp",
        "credential",
        "cert",
        "db",
        "firestore",
        "use",
        "set",
        "static",
        "join",
        "__dirname",
        "urlencoded",
        "extended",
        "json",
        "get",
        "req",
        "res",
        "docRef",
        "collection",
        "doc",
        "first",
        "last",
        "born",
        "status",
        "send",
        "PersonalityInsightsV3",
        "IamAuthenticator",
        "personalityInsights",
        "version",
        "authenticator",
        "apikey",
        "process",
        "env",
        "IBMKEY",
        "serviceUrl",
        "calculate_similarity",
        "user",
        "candidate",
        "num",
        "per",
        "i",
        "Math",
        "min",
        "raw_score",
        "max",
        "put",
        "userProfileParams",
        "content",
        "body",
        "userText",
        "contentType",
        "consumptionPreferences",
        "rawScores",
        "user_profile",
        "profile",
        "elections",
        "election",
        "election_id",
        "candidates",
        "name",
        "district",
        "candidate_profiles",
        "candidate_content",
        "candidateProfileParams",
        "push",
        "needs_score",
        "result",
        "needs",
        "values_score",
        "values",
        "error",
        "console",
        "log",
        "document",
        "item",
        "exists",
        "create",
        "response",
        "candidate_profile",
        "port",
        "PORT",
        "listen"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/sathvika/Desktop/api-ivyhacks/src/",
      "sourcesContent": [
        "// import apiRouter from './router';\nconst express = require('express');\nconst cors = require('cors');\nconst morgan = require('morgan');\nconst path = require('path');\nconst bodyParser = require('body-parser');\n\nconst dotenv = require('dotenv');\ndotenv.config({ silent: true });\n\n// initialize\nconst app = express();\n\nconst admin = require('firebase-admin');\n\nconst serviceAccount = require('../permissions.json');\n\nconst Apify = require('apify');\n\nApify.client.setOptions({ token: 'HPHxehsbm8m2t4iEvWpu8sFeJ' });\n\nconst axios = require('axios');\n\nlet data = '';\n\nconst config = {\n  method: 'get',\n  url: 'https://api.apify.com/v2/acts/pocesar~facebook-pages-scraper/runs/last/dataset/items?token=HPHxehsbm8m2t4iEvWpu8sFeJ\\n',\n  headers: {\n    Cookie: 'AWSALB=CJFq9Ff621KPwyrNjrbVdikBoCaXzEvywP4PU+TEED2YEJEufiqiHIJAhSUBW2ms67c1AebTxKBUC07L49dZ7HKeF4wersmImyHNVpMN6MrtIYQc5iEteMxFCd1r; AWSALBCORS=CJFq9Ff621KPwyrNjrbVdikBoCaXzEvywP4PU+TEED2YEJEufiqiHIJAhSUBW2ms67c1AebTxKBUC07L49dZ7HKeF4wersmImyHNVpMN6MrtIYQc5iEteMxFCd1r',\n  },\n  data,\n};\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount)\n});\n\nconst db = admin.firestore();\n\n// enable/disable cross origin resource sharing if necessary\napp.use(cors());\n\n// enable/disable http request logging\napp.use(morgan('dev'));\n\n// enable only if you want templating\napp.set('view engine', 'ejs');\n\n// enable only if you want static assets from folder static\napp.use(express.static('static'));\n\n// this just allows us to render ejs from the ../app/views directory\napp.set('views', path.join(__dirname, '../src/views'));\n\n// enable json message body for posting data to API\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\n\n// additional init stuff should go before hitting the routing\n\n// REGISTER OUR ROUTES -------------------------------\n// all of our routes will be prefixed with /api\n// this should go AFTER body parser\n// app.use('/api', apiRouter);\n\napp.get('/api/hello-world', async (req, res) => {\n    const docRef = db.collection('tests').doc('alovelace');\n\n    await docRef.set({\n        first: 'Ada',\n        last: 'Lovelace',\n        born: 1815\n    });\n    return res.status(200).send('Hello World!');\n});\n\nconst PersonalityInsightsV3 = require('ibm-watson/personality-insights/v3');\nconst { IamAuthenticator } = require('ibm-watson/auth');\n\nconst personalityInsights = new PersonalityInsightsV3({\n    version: '2017-10-13',\n    authenticator: new IamAuthenticator({\n      apikey: process.env.IBMKEY,\n    }),\n    serviceUrl: 'https://api.us-east.personality-insights.watson.cloud.ibm.com/instances/e243b357-33f5-45ec-a2e3-a4fdabccd55c',\n  });\n\n\nfunction calculate_similarity(user, candidate, num) {\n    let per = 0;\n    for (i = 0; i < num; i++) {\n        per += Math.min(user[i].raw_score, candidate[i].raw_score)/Math.max(user[i].raw_score, candidate[i].raw_score);\n    }\n    return (per / num)\n}\n\n\napp.put('/api/text-recommendations/', async (req, res) => {\n\n        // get user profile from ibm\n        const userProfileParams = {\n            // req.body.userText\n            content: req.body.userText,\n            contentType: 'text/plain;charset=utf-8',\n            consumptionPreferences: true,\n            rawScores: true,\n        };\n        let user_profile = await personalityInsights.profile(userProfileParams);\n    \n        // for each election in elections\n        // console.log(req.body.elections);\n        const elections = req.body.elections;\n        for (election of elections) {\n            // eslint-disable-next-line consistent-return\n                try {\n                    // string parse input for election_id\n                    const election_id = election.candidates[0].name + election.district.name;\n                    let candidate_profiles = []\n                    // try and get candidates' profiles from election\n                            for (candidate of election.candidates) {\n                                let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\"\n                                const candidateProfileParams = {\n                                    content: candidate_content,\n                                    contentType: 'text/plain;charset=utf-8',\n                                    consumptionPreferences: true,\n                                    rawScores: true,\n                                };\n\n                                profile = await personalityInsights.profile(candidateProfileParams);\n                                // add profile to candidate json\n                                candidate[\"profile\"] = profile;\n                                // add profile to candidate profiles for store in firebase\n                                candidate_profiles.push(profile);\n                                // calculate needs_score and values_score with user_profile\n                                const needs_score = calculate_similarity(user_profile.result.needs, candidate.profile.result.needs, 12);\n                                const values_score = calculate_similarity(user_profile.result.values, candidate.profile.result.values, 5);\n                                candidate.profile[\"needs_score\"] = needs_score;\n                                candidate.profile[\"values_score\"] = values_score;\n                                // take average and add to candidate.profile under \"average_score\"\n                                candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n                            }\n                        } catch (error) {\n                            console.log(error);\n                            return res.status(500).send(error);\n                        } \n            }\n            // return elections\n            return res.status(200).send({elections});\n        });\n\n        app.put('/api/slide-recommendations/', async (req, res) => {\n            const user_profile = req.body.user;\n            // for each election in elections\n            // console.log(req.body.elections);\n            const elections = req.body.elections;\n            for (election of elections) {\n                // eslint-disable-next-line consistent-return\n                    try {\n                        // string parse input for election_id\n                        const election_id = election.candidates[0].name + election.district.name;\n        \n                        // try and get candidates' profiles from election\n                        const document = db.collection('elections').doc(election_id);\n                        let item = await document.get();\n                        let candidate_profiles =[];\n                        // if candidates' profiles from election not stored in firebase\n                        if (!item.exists){\n                            try {\n                                for (candidate of election.candidates) {\n                                    let candidate_content = \"Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, Ted, his wife Heidi, their two daughters Caroline and Catherine, and his entire family have been blessed to live the American Dream — the idea that anyone, through hard work and determination, can achieve anything. And he is committed to ensuring every family has that same opportunity.\"\n                                    const candidateProfileParams = {\n                                        content: candidate_content,\n                                        contentType: 'text/plain;charset=utf-8',\n                                        consumptionPreferences: true,\n                                        rawScores: true,\n                                    };\n    \n                                    profile = await personalityInsights.profile(candidateProfileParams);\n                                    // add profile to candidate json\n                                    candidate[\"profile\"] = profile;\n                                    // add profile to candidate profiles for store in firebase\n                                    candidate_profiles.push(profile);\n                                    // calculate needs_score and values_score with user_profile\n                                    const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n                                    const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n                                    candidate.profile[\"needs_score\"] = needs_score;\n                                    candidate.profile[\"values_score\"] = values_score;\n                                    // take average and add to candidate.profile under \"average_score\"\n                                    candidate.profile[\"average_score\"] = (needs_score + values_score) / 2;\n                                }\n                                // create elections entry in firebase\n                                console.log(\"candidate_profiles\", candidate_profiles);\n                                await db.collection('elections').doc('/' + election_id + '/')\n                                    .create({election: candidate_profiles});\n                            } catch (error) {\n                                console.log(error);\n                                return res.status(500).send(error);\n                            } \n                        // if candidates' profiles already stored in firebase\n                        } else {\n                            // response = {election: candidate_profiles}\n                            let response = item.data();\n                            let candidate_profiles = response.election;\n                            for (candidate_profile of candidate_profiles) {\n                                // calculate needs_score and values_score with user_profile\n                                const needs_score = calculate_similarity(user_profile.needs, candidate.profile.result.needs, 12);\n                                const values_score = calculate_similarity(user_profile.values, candidate.profile.result.values, 5);\n                                candidate_profile[\"needs_score\"] = needs_score;\n                                candidate_profile[\"values_score\"] = values_score;\n                                // take average and add to candidate.profile under \"average_score\"\n                                candidate_profile[\"average_score\"] = (needs_score + values_score) / 2;\n                                // add profile to candidate json\n                                candidate[\"profile\"] = candidate_profile;\n                            }\n                        }\n                    } catch (error) {\n                        console.log(error);\n                        return res.status(500).send(error);\n                    };\n                }\n                // return elections\n                return res.status(200).send({elections});\n            });\n\n\n// START THE SERVER\n// =============================================================================\nconst port = process.env.PORT || 8081;\napp.listen(port);\n\nconsole.log(`listening on: ${port}`);"
      ]
    },
    "sourceType": "module",
    "mtime": 1601834060342
  }
}